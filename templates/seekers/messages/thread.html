{% extends "seekers/seekers_base.html" %}
{% load static %}
{% block content %}
<div class="container mx-auto px-4">
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="h-screen flex flex-col">
            <!-- Thread Header -->
            <div class="p-4 border-b border-gray-light flex items-center">
                <img src="{% if recipient.profile_picture %}{{ recipient.profile_picture.url }}{% else %}{% static 'img/default-profile.png' %}{% endif %}" 
                     alt="{{ recipient.get_full_name }}" class="w-10 h-10 rounded-full object-cover">
                <div class="ml-3">
                    <h3 class="font-medium">{{ recipient.get_full_name }}</h3>
                    <p class="text-xs text-gray-500">Landlord</p>
                </div>
            </div>
            
            <!-- Messages -->
            <div class="flex-1 overflow-y-auto p-4 space-y-4" id="messages-container">
                {% for message in messages %}
                <div class="flex {% if message.sender == request.user %}justify-end{% else %}justify-start{% endif %}">
                    <div class="max-w-xs md:max-w-md lg:max-w-lg rounded-lg p-3 {% if message.sender == request.user %}bg-primary-100{% else %}bg-gray-100{% endif %}">
                        <p class="text-sm">{{ message.content }}</p>
                        <p class="text-xs text-gray-500 mt-1 text-right">{{ message.created_at|time }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Message Input -->
            <div class="p-4 border-t border-gray-light">
                <!-- FIX: Use property.id instead of recipient.id -->
                <form method="post" action="{% url 'seekers:property_message' property.id %}" id="message-form">
                    {% csrf_token %}
                    <div class="flex items-center">
                        <input type="text" name="content" placeholder="Type your message..." 
                               class="flex-1 px-4 py-2 rounded-l-lg border border-gray-300 focus:ring-2 focus:ring-primary-400 focus:border-primary-400"
                               required>
                        <button type="submit" class="bg-primary-600 text-white px-4 py-2 rounded-r-lg hover:bg-primary-700 transition">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Auto scroll to bottom of messages
    const messagesContainer = document.getElementById('messages-container');
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
</script>
{% endblock %}